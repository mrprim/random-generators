"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var sample=require("../utils/sample");var nameGenerator=require("./name.barbarian");var roll4dF=require("../utils/dice").roll4dF;var getFateChartValue=require("../data/layout.fate").getFateChartValue;var getSynonym=require("../data/approaches.thesaurus").getSynonym;var getClass=require("../data/classes").getClass;var bioforms=require("../data/bioforms.fate");var bugsAndFish=require("../data/bugsAndFish.fate");var herpsAndDinos=require("../data/herpsAndDinos.fate");var birdsAndMammals=require("../data/birdsAndMammals.fate");var powers=require("../data/powers.fate");var weapons=require("../data/weapons.fate");var adaptations=require("../data/adaptations.fate");var animalCharts=[bugsAndFish,herpsAndDinos,birdsAndMammals];var stuntCharts=[powers,weapons,adaptations];var formatters=require("../formatters");function getName(){var name=nameGenerator();return name.charAt(0).toUpperCase()+name.slice(1)}function formatAnimalString(animal){var animalOptions=animal.subvalue?animal.subvalue.split(","):animal.value.split(",");return sample(animalOptions).trim()}function getApproaches(setupApproaches){var rslt=[];var values=[3,2,2,1,1,0];var approaches=["Careful","Clever","Flashy","Forceful","Quick","Sneaky"];var _loop=function _loop(){var approach=sample(setupApproaches);var value=values[0];rslt.push({approach:approach,value:value});setupApproaches=setupApproaches.filter(function(a){return a!==approach});approaches=approaches.filter(function(a){return a!==approach});values.shift()};while(setupApproaches.length>0){_loop()}var _loop2=function _loop2(){var approach=sample(approaches);var value=values[0];rslt.push({approach:approach,value:value});approaches=approaches.filter(function(a){return a!==approach});values.shift()};while(approaches.length>0){_loop2()}rslt.sort(function(a,b){if(a.value<b.value){return+1}if(a.value>b.value){return-1}if(a.approach<b.approach){return-1}if(a.approach>b.approach){return+1}return 0});return rslt}function getDescriptorFromApproaches(approaches){return getSynonym(approaches[0].approach)}function getClassFromApproaches(approaches){return getClass(approaches[0].approach)}function getStunt(previousStunt){var stuntChart=sample(stuntCharts);var stunt=getFateChartValue(stuntChart,roll4dF());while(stunt===previousStunt){stunt=getFateChartValue(stuntChart,roll4dF())}if(stuntChart===powers){stunt.type="Power"}else if(stuntChart===adaptations){stunt.type="Adaptation"}else if(stuntChart===weapons){stunt.type="Weapon"}return stunt}function getAspects(){var character=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{bioform:getMainConcept(character)}}function getMainConcept(character){var type=character.type,animals=character.animals,descriptor=character.descriptor,characterClass=character.characterClass;var animalString=animals.length?animals.join("/").trim()+"-":"";return(descriptor+" "+animalString+type+" "+characterClass).toLowerCase()}function characterGenerator(){var character={};var animals=[];var stunts=[];//  const aspects = {}
var approaches=[];var setupApproaches=[];var firstAnimalChart;var bioform=getFateChartValue(bioforms,roll4dF());if(bioform.approach){setupApproaches.push(bioform.approach)}if(bioform.animal){var chart=sample(animalCharts);var animal=getFateChartValue(chart,roll4dF());var animalString=formatAnimalString(animal);animals.push(animalString);setupApproaches.push(animal.approach);firstAnimalChart=chart}if(bioform.animal&&bioform.secondAnimal){var filteredCharts=animalCharts.filter(function(chart,i){return firstAnimalChart!==chart});var _chart=sample(filteredCharts);var _animal=getFateChartValue(_chart,roll4dF());var _animalString=formatAnimalString(_animal);animals.push(_animalString);setupApproaches.push(_animal.approach)}var stunt1=getStunt();var stunt2=getStunt(stunt1);stunts.push(stunt1);setupApproaches.push(sample(stunt1.approach.split("/")));stunts.push(stunt2);setupApproaches.push(sample(stunt2.approach.split("/")));approaches=getApproaches(setupApproaches);character.name=getName();character.type=bioform.value;character.animals=animals;character.stunts=stunts;character.approaches=approaches;character.descriptor=getDescriptorFromApproaches(approaches);character.characterClass=getClassFromApproaches(approaches);character.aspects=getAspects(character);character.toString=function(format){var type=character.type,animals=character.animals,descriptor=character.descriptor,characterClass=character.characterClass;var animalString=animals.length?animals.join("/").trim()+"-":"";var f=formatters(format);var bioform=(descriptor+" "+f.t(animalString,animalString.replace("/","-"))+type+" "+characterClass).toLowerCase();return f.strong(this.name)+" the "+bioform};return character}var _default=characterGenerator;exports["default"]=_default;